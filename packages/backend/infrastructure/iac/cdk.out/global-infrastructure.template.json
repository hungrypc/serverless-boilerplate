{
 "Resources": {
  "eventbus7CF8FDD5": {
   "Type": "AWS::Events::EventBus",
   "Properties": {
    "Name": "phil"
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/event-bus/Resource"
   }
  },
  "deploymentbucket": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "AccelerateConfiguration": {
     "AccelerationStatus": "Enabled"
    },
    "BucketName": "philip-chan-phil-deployment"
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/deployment-bucket"
   }
  },
  "certificateCertificateRequestorFunctionServiceRoleA4FA97BB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/certificate/CertificateRequestorFunction/ServiceRole/Resource"
   }
  },
  "certificateCertificateRequestorFunctionServiceRoleDefaultPolicy8ED55FEE": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "acm:RequestCertificate",
        "acm:DescribeCertificate",
        "acm:DeleteCertificate",
        "acm:AddTagsToCertificate"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "route53:GetChange",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "route53:changeResourceRecordSets",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":route53:::hostedzone/Z09051933NPN2UOR4AVC1"
         ]
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "certificateCertificateRequestorFunctionServiceRoleDefaultPolicy8ED55FEE",
    "Roles": [
     {
      "Ref": "certificateCertificateRequestorFunctionServiceRoleA4FA97BB"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/certificate/CertificateRequestorFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "certificateCertificateRequestorFunction5D4BA95F": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Ref": "AssetParameters57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52S3BucketAF5CA86B"
     },
     "S3Key": {
      "Fn::Join": [
       "",
       [
        {
         "Fn::Select": [
          0,
          {
           "Fn::Split": [
            "||",
            {
             "Ref": "AssetParameters57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52S3VersionKey50057F68"
            }
           ]
          }
         ]
        },
        {
         "Fn::Select": [
          1,
          {
           "Fn::Split": [
            "||",
            {
             "Ref": "AssetParameters57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52S3VersionKey50057F68"
            }
           ]
          }
         ]
        }
       ]
      ]
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "certificateCertificateRequestorFunctionServiceRoleA4FA97BB",
      "Arn"
     ]
    },
    "Handler": "index.certificateRequestHandler",
    "Runtime": "nodejs14.x",
    "Timeout": 900
   },
   "DependsOn": [
    "certificateCertificateRequestorFunctionServiceRoleDefaultPolicy8ED55FEE",
    "certificateCertificateRequestorFunctionServiceRoleA4FA97BB"
   ],
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/certificate/CertificateRequestorFunction/Resource",
    "aws:asset:path": "asset.57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "certificateCertificateRequestorResourceFD86DD58": {
   "Type": "AWS::CloudFormation::CustomResource",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "certificateCertificateRequestorFunction5D4BA95F",
      "Arn"
     ]
    },
    "DomainName": "philip-chan.me",
    "SubjectAlternativeNames": [
     "*.philip-chan.me"
    ],
    "HostedZoneId": "Z09051933NPN2UOR4AVC1"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/certificate/CertificateRequestorResource/Default"
   }
  },
  "philrestapiA7555F30": {
   "Type": "AWS::ApiGateway::RestApi",
   "Properties": {
    "Name": "phil-rest-api"
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/Resource"
   }
  },
  "philrestapiCloudWatchRoleAB482CF5": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "apigateway.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/CloudWatchRole/Resource"
   }
  },
  "philrestapiAccount00D1E6F1": {
   "Type": "AWS::ApiGateway::Account",
   "Properties": {
    "CloudWatchRoleArn": {
     "Fn::GetAtt": [
      "philrestapiCloudWatchRoleAB482CF5",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "philrestapiA7555F30"
   ],
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/Account"
   }
  },
  "philrestapiDeployment6BCAF7FA07e76824944243804ebf03eac35b0527": {
   "Type": "AWS::ApiGateway::Deployment",
   "Properties": {
    "RestApiId": {
     "Ref": "philrestapiA7555F30"
    },
    "Description": "Automatically created by the RestApi construct"
   },
   "DependsOn": [
    "philrestapiANYBB66DDB4",
    "philrestapiOPTIONS84B90ACB",
    "philrestapiErrorResponseModel74A136AE"
   ],
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/Deployment/Resource"
   }
  },
  "philrestapiDeploymentStagephilB042FBA8": {
   "Type": "AWS::ApiGateway::Stage",
   "Properties": {
    "RestApiId": {
     "Ref": "philrestapiA7555F30"
    },
    "DeploymentId": {
     "Ref": "philrestapiDeployment6BCAF7FA07e76824944243804ebf03eac35b0527"
    },
    "StageName": "phil"
   },
   "DependsOn": [
    "philrestapiAccount00D1E6F1"
   ],
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/DeploymentStage.phil/Resource"
   }
  },
  "philrestapiCustomDomain9DE8EC77": {
   "Type": "AWS::ApiGateway::DomainName",
   "Properties": {
    "DomainName": "api.philip-chan.me",
    "EndpointConfiguration": {
     "Types": [
      "REGIONAL"
     ]
    },
    "RegionalCertificateArn": {
     "Fn::GetAtt": [
      "certificateCertificateRequestorResourceFD86DD58",
      "Arn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/CustomDomain/Resource"
   }
  },
  "philrestapiCustomDomainMapglobalinfrastructurephilrestapi80AF4249E4EF0DEF": {
   "Type": "AWS::ApiGateway::BasePathMapping",
   "Properties": {
    "DomainName": {
     "Ref": "philrestapiCustomDomain9DE8EC77"
    },
    "RestApiId": {
     "Ref": "philrestapiA7555F30"
    },
    "Stage": {
     "Ref": "philrestapiDeploymentStagephilB042FBA8"
    }
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/CustomDomain/Map:--=>globalinfrastructurephilrestapi80AF4249/Resource"
   }
  },
  "philrestapiOPTIONS84B90ACB": {
   "Type": "AWS::ApiGateway::Method",
   "Properties": {
    "HttpMethod": "OPTIONS",
    "ResourceId": {
     "Fn::GetAtt": [
      "philrestapiA7555F30",
      "RootResourceId"
     ]
    },
    "RestApiId": {
     "Ref": "philrestapiA7555F30"
    },
    "AuthorizationType": "NONE",
    "Integration": {
     "IntegrationResponses": [
      {
       "ResponseParameters": {
        "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,access-token,x-correlated-request-id'",
        "method.response.header.Access-Control-Allow-Origin": "'*'",
        "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
       },
       "StatusCode": "204"
      }
     ],
     "RequestTemplates": {
      "application/json": "{ statusCode: 200 }"
     },
     "Type": "MOCK"
    },
    "MethodResponses": [
     {
      "ResponseParameters": {
       "method.response.header.Access-Control-Allow-Headers": true,
       "method.response.header.Access-Control-Allow-Origin": true,
       "method.response.header.Access-Control-Allow-Methods": true
      },
      "StatusCode": "204"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/Default/OPTIONS/Resource"
   }
  },
  "philrestapiANYBB66DDB4": {
   "Type": "AWS::ApiGateway::Method",
   "Properties": {
    "HttpMethod": "ANY",
    "ResourceId": {
     "Fn::GetAtt": [
      "philrestapiA7555F30",
      "RootResourceId"
     ]
    },
    "RestApiId": {
     "Ref": "philrestapiA7555F30"
    },
    "AuthorizationType": "NONE",
    "Integration": {
     "Type": "MOCK"
    },
    "MethodResponses": [
     {
      "ResponseModels": {
       "application/json": {
        "Ref": "philrestapiErrorResponseModel74A136AE"
       }
      },
      "ResponseParameters": {
       "method.response.header.Access-Control-Allow-Origin": true,
       "method.response.header.Access-Control-Allow-Headers": true,
       "method.response.header.Access-Control-Allow-Credentials": true
      },
      "StatusCode": "500"
     },
     {
      "ResponseModels": {
       "application/json": {
        "Ref": "philrestapiErrorResponseModel74A136AE"
       }
      },
      "ResponseParameters": {
       "method.response.header.Access-Control-Allow-Origin": true,
       "method.response.header.Access-Control-Allow-Headers": true,
       "method.response.header.Access-Control-Allow-Credentials": true
      },
      "StatusCode": "400"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/Default/ANY/Resource"
   }
  },
  "philrestapiErrorResponseModel74A136AE": {
   "Type": "AWS::ApiGateway::Model",
   "Properties": {
    "RestApiId": {
     "Ref": "philrestapiA7555F30"
    },
    "ContentType": "application/json",
    "Name": "ErrorResponseModel",
    "Schema": {
     "title": "errorResponse",
     "type": "object",
     "properties": {
      "message": {
       "type": "string"
      }
     },
     "$schema": "http://json-schema.org/draft-04/schema#"
    }
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/ErrorResponseModel/Resource"
   }
  },
  "philrestapiphilroute53apigatewayarecord53B6C101": {
   "Type": "AWS::Route53::RecordSet",
   "Properties": {
    "Name": "api.philip-chan.me.",
    "Type": "A",
    "AliasTarget": {
     "DNSName": {
      "Fn::GetAtt": [
       "philrestapiCustomDomain9DE8EC77",
       "RegionalDomainName"
      ]
     },
     "HostedZoneId": {
      "Fn::GetAtt": [
       "philrestapiCustomDomain9DE8EC77",
       "RegionalHostedZoneId"
      ]
     }
    },
    "HostedZoneId": "Z09051933NPN2UOR4AVC1"
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/phil-rest-api/phil-route-53-api-gateway-a-record/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/11Ry27CMBD8Fu6LaURfx0Job7QoSL1vnSUYEjuy1yAU+d9rJ6SgnnZ2PPbujDORPb+Ih8kbnt1UlsdZJ40l0W0Z5RHynf7y3HqG3GjH1kuGgpzxVhIsnCOOukrpCnLv2DR/Z/HiPd6gxYaYbIA0p6MTaXaie0916V3SjDiAm4suEksvj8QwlCU6CiDJstopiUwNaqzIipV231irMlJlfjuGGpufEkX34bVkZXQaMeIAChvRFaYeNk11Y2olL/2yPUprTDFZdKJ3CtiqKr58xku8So4Xrbr6HOFCSuM1w4ra2lya6Cexd11Kqx85gJVpUOnPGE2vu3XJ7QZ5v8a27dONafyjxngTD2vivSmT7IrWpqS67xMIYI1neoq5LgqKH1wOiye0JQ4hgI46cXCzU/YoslcxnxycUlMb3aiGRDHUX1FDoSItAgAA"
   },
   "Metadata": {
    "aws:cdk:path": "global-infrastructure/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "eventbusphileventbusarnD8837944": {
   "Value": {
    "Fn::GetAtt": [
     "eventbus7CF8FDD5",
     "Arn"
    ]
   },
   "Export": {
    "Name": "phil-event-bus-arn"
   }
  },
  "deploymentbucketphildeployment94D0A7E1": {
   "Value": "philip-chan-phil-deployment",
   "Export": {
    "Name": "phil-deployment"
   }
  },
  "phildomainname": {
   "Value": "philip-chan.me",
   "Export": {
    "Name": "phil-domain-name"
   }
  },
  "certificatephilcertificatearn79558AE2": {
   "Value": {
    "Fn::GetAtt": [
     "certificateCertificateRequestorResourceFD86DD58",
     "Arn"
    ]
   },
   "Export": {
    "Name": "phil-certificate-arn"
   }
  },
  "philrestapiEndpoint262880D2": {
   "Value": {
    "Fn::Join": [
     "",
     [
      "https://",
      {
       "Ref": "philrestapiA7555F30"
      },
      ".execute-api.us-east-1.",
      {
       "Ref": "AWS::URLSuffix"
      },
      "/",
      {
       "Ref": "philrestapiDeploymentStagephilB042FBA8"
      },
      "/"
     ]
    ]
   }
  },
  "philrestapiphilrestapiid4ABF7714": {
   "Value": {
    "Ref": "philrestapiA7555F30"
   },
   "Export": {
    "Name": "phil-rest-api-id"
   }
  },
  "philrestapiphilrestapirootresourceid8F65111B": {
   "Value": {
    "Fn::GetAtt": [
     "philrestapiA7555F30",
     "RootResourceId"
    ]
   },
   "Export": {
    "Name": "phil-rest-api-root-resource-id"
   }
  }
 },
 "Parameters": {
  "AssetParameters57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52S3BucketAF5CA86B": {
   "Type": "String",
   "Description": "S3 bucket for asset \"57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52\""
  },
  "AssetParameters57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52S3VersionKey50057F68": {
   "Type": "String",
   "Description": "S3 key for asset version \"57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52\""
  },
  "AssetParameters57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52ArtifactHash050EEE47": {
   "Type": "String",
   "Description": "Artifact hash for asset \"57ed3297d84e7c092939da72067d3c6c454ad63e86b4b5079d4306b424eafd52\""
  }
 }
}